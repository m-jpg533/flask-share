<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å…ƒå®µç‡ˆç± ç¥ç¦</title>

<meta property="og:title" content="å…ƒå®µç‡ˆç± ç¥ç¦">
<meta property="og:description" content="é»é–‹çœ‹å°ˆå±¬ç¥ç¦">
<meta property="og:image" content="https://m-jpg533.github.io/flask-media-share/fireworks-cover.jpg">
<meta property="og:type" content="website">

<style>
body{
  margin:0;
  background:black;
  overflow:hidden;
  touch-action:none;
  font-family:Arial, sans-serif;
}

canvas{
  position:absolute;
  z-index:1;
}

#text{
  position:fixed;
  width:100%;
  top:35%;
  text-align:center;
  font-size:clamp(26px,7vw,52px);
  font-weight:bold;
  color:gold;
  z-index:10;
  animation: glow 1.2s infinite alternate;
}

@keyframes glow{
  from{ text-shadow:0 0 10px gold; }
  to{ text-shadow:0 0 35px orange; }
}

#nameBox{
  position:fixed;
  top:52%;
  width:100%;
  text-align:center;
  z-index:15;
}

#nameBox input{
  font-size:18px;
  padding:8px;
  border-radius:6px;
  border:none;
}

#nameBox button{
  font-size:16px;
  padding:8px 12px;
  margin-left:6px;
  border:none;
  border-radius:6px;
}

#musicBtn{
  position:fixed;
  bottom:20px;
  right:20px;
  z-index:20;
  padding:10px 14px;
  border:none;
  border-radius:8px;
}

#editBtn{
  position:fixed;
  top:20px;
  right:20px;
  z-index:20;
  padding:8px 12px;
  border:none;
  border-radius:6px;
}

#lineShareBtn{
  position:fixed;
  bottom:20px;
  left:20px;
  z-index:20;
  padding:10px 14px;
  font-size:16px;
  border:none;
  border-radius:8px;
  background:#06C755;
  color:white;
}
</style>
</head>

<body>

<div id="text">å…ƒå®µå¿«æ¨‚</div>

<div id="nameBox">
  <input id="nameInput" placeholder="è¼¸å…¥åå­—">
  <button id="nameBtn">ç¢ºèª</button>
</div>

<button id="editBtn" style="display:none;">é‡æ–°è¼¸å…¥åå­—</button>
<button id="musicBtn">ğŸ”Š éŸ³æ¨‚</button>
<button id="lineShareBtn">LINE åˆ†äº«</button>

<canvas id="fire"></canvas>

<audio id="bgm" loop>
  <source src="https://m-jpg533.github.io/flask-share/13.mp3.mp3" type="audio/mpeg">
</audio>

<script>
const canvas = document.getElementById("fire");
const ctx = canvas.getContext("2d");
const bgm = document.getElementById("bgm");

function resize(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

let lanterns = [];

/* å»ºç«‹ç‡ˆç±  */
function createLantern(){
  lanterns.push({
    x: Math.random()*canvas.width,
    y: canvas.height + 40,
    w: 14 + Math.random()*10,
    h: 20 + Math.random()*12,
    speed: 0.6 + Math.random()*1.2,
    drift: (Math.random()-0.5)*0.6,
    alpha: 1,
    color: `hsl(${Math.random()*360},100%,60%)`
  });
}

/* ç•«ç‡ˆç± é€ å‹ */
function drawLantern(l){
  ctx.globalAlpha = l.alpha;

  // å…‰æšˆ
  const g = ctx.createRadialGradient(l.x, l.y, 0, l.x, l.y, l.h*2);
  g.addColorStop(0, l.color);
  g.addColorStop(1, "transparent");
  ctx.fillStyle = g;
  ctx.beginPath();
  ctx.arc(l.x, l.y, l.h*2, 0, Math.PI*2);
  ctx.fill();

  // ä¸Šè“‹
  ctx.fillStyle = "gold";
  ctx.fillRect(l.x - l.w/2, l.y - l.h/2 - 4, l.w, 4);

  // ç‡ˆç± æœ¬é«”ï¼ˆæ©¢åœ“ï¼‰
  ctx.fillStyle = l.color;
  ctx.beginPath();
  ctx.ellipse(l.x, l.y, l.w/2, l.h/2, 0, 0, Math.PI*2);
  ctx.fill();

  // ç‡ˆç± ç´‹è·¯
  ctx.strokeStyle = "rgba(255,255,255,0.3)";
  for(let i=-2;i<=2;i++){
    ctx.beginPath();
    ctx.moveTo(l.x + i*3, l.y - l.h/2);
    ctx.lineTo(l.x + i*3, l.y + l.h/2);
    ctx.stroke();
  }

  // ä¸‹ç©—
  ctx.strokeStyle = "gold";
  ctx.beginPath();
  ctx.moveTo(l.x, l.y + l.h/2);
  ctx.lineTo(l.x, l.y + l.h/2 + 8);
  ctx.stroke();

  ctx.globalAlpha = 1;
}

/* å‹•ç•« */
function draw(){
  ctx.fillStyle="rgba(0,0,0,0.25)";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  lanterns.forEach((l,i)=>{
    drawLantern(l);
    l.y -= l.speed;
    l.x += l.drift;
    l.alpha -= 0.002;

    if(l.alpha <= 0 || l.y < -40){
      lanterns.splice(i,1);
    }
  });

  requestAnimationFrame(draw);
}

setInterval(createLantern, 100);
draw();

/* éŸ³æ¨‚ */
musicBtn.onclick=()=>{
  if(bgm.paused){
    bgm.play();
    musicBtn.textContent="ğŸ”Š éŸ³æ¨‚";
  }else{
    bgm.pause();
    musicBtn.textContent="ğŸ”‡ éœéŸ³";
  }
};

/* åå­—åŠŸèƒ½ */
const text = document.getElementById("text");
const nameBox = document.getElementById("nameBox");
const nameInput = document.getElementById("nameInput");
const editBtn = document.getElementById("editBtn");

function setName(name){
  text.textContent = `${name} å…ƒå®µå¿«æ¨‚`;
  nameBox.style.display="none";
  editBtn.style.display="block";
}

document.getElementById("nameBtn").onclick = () => {
  const name = nameInput.value.trim();
  if(!name) return;
  const newUrl = location.pathname + "?name=" + encodeURIComponent(name);
  history.replaceState(null,"",newUrl);
  setName(name);
};

editBtn.onclick=()=>{
  nameBox.style.display="block";
  editBtn.style.display="none";
};

const params = new URLSearchParams(location.search);
const urlName = params.get("name");
if(urlName){
  nameInput.value = urlName;
  setName(urlName);
}

/* LINE åˆ†äº« */
lineShareBtn.onclick=()=>{
  const url = location.href;
  if(navigator.share){
    navigator.share({title:"å…ƒå®µç¥ç¦",url:url});
  }else{
    window.open("https://social-plugins.line.me/lineit/share?url="+encodeURIComponent(url));
  }
};

/* é›¢é–‹åœæ­¢éŸ³æ¨‚ */
document.addEventListener("visibilitychange",()=>{if(document.hidden) bgm.pause();});
window.addEventListener("pagehide",()=>bgm.pause());
window.addEventListener("beforeunload",()=>bgm.pause());
</script>

</body>
</html>