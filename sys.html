<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å…ƒå®µç…™ç«ç¥ç¦</title>

<!-- LINE åˆ†äº«å°é¢ -->
<meta property="og:title" content="å…ƒå®µç…™ç«ç¥ç¦">
<meta property="og:description" content="é»é–‹çœ‹å°ˆå±¬ç…™ç«ç¥ç¦ ğŸ†">
<meta property="og:image" content="https://m-jpg533.github.io/flask-media-share/fireworks-cover.jpg">
<meta property="og:type" content="website">

<style>
body{
  margin:0;
  background:black;
  overflow:hidden;
  touch-action:none;
  font-family:Arial, sans-serif;
}

canvas{
  position:absolute;
  z-index:1;
}

/* æ–‡å­—é¡¯ç¤ºåœ¨ç•«é¢ä¸­å¤®ï¼Œé‡‘è‰² */
#text{
  position:fixed;
  width:100%;
  top:35%;
  text-align:center;
  font-size:clamp(24px,6vw,48px);
  font-weight:bold;
  color:gold;
  z-index:10;
  animation: glow 1s infinite alternate;
}

@keyframes glow{
  from{ text-shadow:0 0 10px gold; }
  to{ text-shadow:0 0 30px yellow; }
}

/* åå­—è¼¸å…¥æ¡† */
#nameBox{
  position:fixed;
  top:50%;
  width:100%;
  text-align:center;
  z-index:15;
}

#nameBox input{
  font-size:18px;
  padding:8px;
  border-radius:6px;
  border:none;
}

#nameBox button{
  font-size:16px;
  padding:8px 12px;
  margin-left:6px;
  border:none;
  border-radius:6px;
}

/* éŸ³æ¨‚æŒ‰éˆ• */
#musicBtn{
  position:fixed;
  bottom:20px;
  right:20px;
  z-index:20;
  padding:10px 14px;
  border:none;
  border-radius:8px;
}

/* é‡æ–°è¼¸å…¥åå­—æŒ‰éˆ• */
#editBtn{
  position:fixed;
  top:20px;
  right:20px;
  z-index:20;
  padding:8px 12px;
  border:none;
  border-radius:6px;
}

/* å·¦ä¸‹ LINE åˆ†äº«æŒ‰éˆ• */
#lineShareBtn{
  position:fixed;
  bottom:20px;
  left:20px;
  z-index:20;
  padding:10px 14px;
  font-size:16px;
  border:none;
  border-radius:8px;
  background:#06C755;
  color:white;
}
</style>
</head>

<body>

<div id="text">ğŸ† å…ƒå®µå¿«æ¨‚ ğŸ†</div>

<div id="nameBox">
  <input id="nameInput" placeholder="è¼¸å…¥åå­—">
  <button id="nameBtn">ç¢ºèª</button>
</div>

<button id="editBtn" style="display:none;">é‡æ–°è¼¸å…¥åå­—</button>
<button id="musicBtn">ğŸ”Š éŸ³æ¨‚</button>
<button id="lineShareBtn">LINE åˆ†äº«</button>

<canvas id="fire"></canvas>

<audio id="bgm" loop>
  <source src="https://m-jpg533.github.io/flask-share/13.mp3.mp3" type="audio/mpeg">
</audio>

<script>
const canvas = document.getElementById("fire");
const ctx = canvas.getContext("2d");
const bgm = document.getElementById("bgm");
const text = document.getElementById("text");
const nameBox = document.getElementById("nameBox");
const nameInput = document.getElementById("nameInput");
const editBtn = document.getElementById("editBtn");
const musicBtn = document.getElementById("musicBtn");
const lineShareBtn = document.getElementById("lineShareBtn");

function resize(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

let particles = [];
let fireColor = "hsl(45,100%,50%)";

/* åå­—è½‰é¡è‰²ï¼Œå›ºå®šæ¯å€‹åå­—çš„ç…™ç«é¡è‰² */
function getColorFromName(name){
  let hash = 0;
  for(let i=0;i<name.length;i++){
    hash = name.charCodeAt(i) + ((hash<<5)-hash);
  }
  return `hsl(${Math.abs(hash)%360},100%,50%)`;
}

/* å½©è‰²ç…™ç«ç²’å­ */
function createFirework(){
  let x = Math.random()*canvas.width;
  let y = Math.random()*canvas.height/2;
  let count = Math.max(50, nameInput.value.length*10); // åå­—é•·åº¦è¶Šé•·ï¼Œç…™ç«è¶Šå¤š

  for(let i=0;i<count;i++){
    particles.push({
      x,y,
      vx:(Math.random()-0.5)*6,
      vy:(Math.random()-0.5)*6,
      life:100,
      color:`hsl(${Math.random()*360},100%,50%)`
    });
  }
}

/* ç¹ªè£½ç…™ç« */
function draw(){
  ctx.fillStyle="rgba(0,0,0,0.2)";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  particles.forEach((p,i)=>{
    ctx.beginPath();
    ctx.arc(p.x,p.y,2,0,Math.PI*2);
    ctx.fillStyle=p.color;
    ctx.fill();
    p.x+=p.vx;
    p.y+=p.vy;
    p.life--;
    if(p.life<=0) particles.splice(i,1);
  });

  requestAnimationFrame(draw);
}
setInterval(createFirework,800);
draw();

/* æ’­æ”¾ç…™ç«+éŸ³æ¨‚ */
function userFire(){
  createFirework();
  bgm.play().catch(()=>{});
}
canvas.addEventListener("click", userFire);
canvas.addEventListener("touchstart", userFire);

/* éŸ³æ¨‚é–‹é—œ */
musicBtn.onclick=()=>{
  if(bgm.paused){
    bgm.play();
    musicBtn.textContent="ğŸ”Š éŸ³æ¨‚";
  }else{
    bgm.pause();
    musicBtn.textContent="ğŸ”‡ éœéŸ³";
  }
};

/* è¨­å®šåå­— */
function setName(name){
  text.textContent=`ğŸ† ${name} å…ƒå®µå¿«æ¨‚ ğŸ†`;
  text.style.color = "gold"; // æ–‡å­—æ°¸é é‡‘è‰²
  fireColor=getColorFromName(name);
  nameBox.style.display="none";
  editBtn.style.display="block";
}

/* ç¢ºèªåå­— â†’ å¯«å…¥ç¶²å€ */
document.getElementById("nameBtn").onclick = () => {
  const name = nameInput.value.trim();
  if(!name) return;

  const newUrl = location.pathname + "?name=" + encodeURIComponent(name);
  history.replaceState(null,"",newUrl);

  setName(name);
};

/* é‡æ–°è¼¸å…¥åå­— */
editBtn.onclick=()=>{
  nameBox.style.display="block";
  editBtn.style.display="none";
};

/* è‡ªå‹•è®€å–ç¶²å€åå­— */
const params = new URLSearchParams(location.search);
const urlName = params.get("name");
if(urlName){
  nameInput.value = urlName;
  setName(urlName);
}

/* LINE åˆ†äº«æŒ‰éˆ• */
lineShareBtn.onclick=()=>{
  const url = location.href;
  if(navigator.share){
    navigator.share({title:"å…ƒå®µç…™ç«ç¥ç¦",url:url});
  }else{
    window.open("https://social-plugins.line.me/lineit/share?url="+encodeURIComponent(url));
  }
};

/* é›¢é–‹é é¢åœæ­¢éŸ³æ¨‚ */
document.addEventListener("visibilitychange",()=>{if(document.hidden) bgm.pause();});
window.addEventListener("pagehide",()=>bgm.pause());
window.addEventListener("beforeunload",()=>bgm.pause());
</script>

</body>
</html>