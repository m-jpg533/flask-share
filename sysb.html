<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å…ƒå®µç‡ˆç± ç¥ç¦</title>

<meta property="og:title" content="å…ƒå®µç‡ˆç± ç¥ç¦">
<meta property="og:description" content="é»é–‹çœ‹å°ˆå±¬ç¥ç¦ ğŸ†">
<meta property="og:image" content="https://m-jpg533.github.io/flask-media-share/fireworks-cover.jpg">
<meta property="og:type" content="website">

<style>
body{
  margin:0;
  overflow:hidden;
  font-family:Arial, sans-serif;
  background:black;
}

canvas{
  position:absolute;
  z-index:1;
}

#text{
  position:fixed;
  width:100%;
  top:32%;
  text-align:center;
  font-size:clamp(28px,7vw,56px);
  font-weight:bold;
  color:gold;
  z-index:10;
  animation: glow 1.5s infinite alternate;
}

@keyframes glow{
  from{ text-shadow:0 0 10px gold; }
  to{ text-shadow:0 0 35px orange; }
}

#nameBox{
  position:fixed;
  top:55%;
  width:100%;
  text-align:center;
  z-index:15;
}

#nameBox input{
  font-size:18px;
  padding:8px;
  border-radius:6px;
  border:none;
}

#nameBox button{
  font-size:16px;
  padding:8px 12px;
  margin-left:6px;
  border:none;
  border-radius:6px;
}

#musicBtn{
  position:fixed;
  bottom:20px;
  right:20px;
  z-index:20;
  padding:10px 14px;
  border:none;
  border-radius:8px;
}

#editBtn{
  position:fixed;
  top:20px;
  right:20px;
  z-index:20;
  padding:8px 12px;
  border:none;
  border-radius:6px;
}

#lineShareBtn{
  position:fixed;
  bottom:20px;
  left:20px;
  z-index:20;
  padding:10px 14px;
  font-size:16px;
  border:none;
  border-radius:8px;
  background:#06C755;
  color:white;
}
</style>
</head>

<body>

<div id="text">å…ƒå®µå¿«æ¨‚</div>

<div id="nameBox">
  <input id="nameInput" placeholder="è¼¸å…¥åå­—">
  <button id="nameBtn">ç¢ºèª</button>
</div>

<button id="editBtn" style="display:none;">é‡æ–°è¼¸å…¥åå­—</button>
<button id="musicBtn">ğŸ”Š éŸ³æ¨‚</button>
<button id="lineShareBtn">LINE åˆ†äº«</button>

<canvas id="fire"></canvas>

<audio id="bgm" loop>
  <source src="https://m-jpg533.github.io/flask-share/13.mp3.mp3" type="audio/mpeg">
</audio>

<script>
const canvas = document.getElementById("fire");
const ctx = canvas.getContext("2d");
const bgm = document.getElementById("bgm");
const text = document.getElementById("text");
const nameBox = document.getElementById("nameBox");
const nameInput = document.getElementById("nameInput");
const editBtn = document.getElementById("editBtn");
const musicBtn = document.getElementById("musicBtn");
const lineShareBtn = document.getElementById("lineShareBtn");

function resize(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

/* â­ æ˜Ÿç©ºèƒŒæ™¯ */
let stars = [];
for(let i=0;i<80;i++){
  stars.push({
    x: Math.random()*canvas.width,
    y: Math.random()*canvas.height,
    r: Math.random()*1.2,
    a: Math.random()
  });
}

/* ğŸ® ç‡ˆç± ç³»çµ± */
let lanterns = [];

function createLantern(){
  // æ¯æ¬¡å»ºç«‹ 6~10 å€‹ç‡ˆç± 
  let count = 3 + Math.floor(Math.random()*2);
  for(let i=0;i<count;i++){
    lanterns.push({
      x: Math.random()*canvas.width,
      y: canvas.height + 60,
      w: 32 + Math.random()*16, // ç‡ˆç± å¯¬
      h: 50 + Math.random()*20, // ç‡ˆç± é«˜
      speed: 0.3 + Math.random()*0.4, // ä¸Šå‡é€Ÿåº¦
      drift: (Math.random()-0.5)*0.3,  // å·¦å³æ¼‚ç§»
      alpha: 1,
      color: `hsl(${Math.random()*360},100%,65%)`
    });
  }
}

/* ç¹ªè£½ç‡ˆç±  + æ˜Ÿç©º */
function draw(){
  // èƒŒæ™¯é»‘ + æ˜Ÿæ˜Ÿ
  ctx.fillStyle="black";
  ctx.fillRect(0,0,canvas.width,canvas.height);
  stars.forEach(s=>{
    ctx.beginPath();
    ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
    ctx.fillStyle=`rgba(255,255,255,${s.a})`;
    ctx.fill();
  });

  // ç¹ªè£½ç‡ˆç± 
  lanterns.forEach((l,i)=>{
    // ç‡ˆç± ä¸»é«”
    ctx.beginPath();
    ctx.ellipse(l.x, l.y, l.w*0.5, l.h, 0, 0, Math.PI*2);
    ctx.fillStyle = l.color;
    ctx.fill();

    // ä¸Šä¸‹è“‹
    ctx.fillRect(l.x-l.w*0.25, l.y-l.h*1.05, l.w*0.5, l.h*0.2);
    ctx.fillRect(l.x-l.w*0.25, l.y+l.h*0.9, l.w*0.5, l.h*0.2);

    // æµè˜‡
    ctx.beginPath();
    ctx.moveTo(l.x, l.y+l.h*1.1);
    ctx.lineTo(l.x, l.y+l.h*1.6);
    ctx.strokeStyle="gold";
    ctx.lineWidth=2;
    ctx.stroke();

    // å…‰æšˆ
    let g = ctx.createRadialGradient(l.x,l.y,0,l.x,l.y,l.h*1.5);
    g.addColorStop(0,l.color);
    g.addColorStop(1,"transparent");
    ctx.fillStyle = g;
    ctx.beginPath();
    ctx.arc(l.x,l.y,l.h*1.5,0,Math.PI*2);
    ctx.fill();

    // ç§»å‹•
    l.y -= l.speed;
    l.x += l.drift;
    l.alpha -= 0.0015;
    if(l.y < -100 || l.alpha <=0){
      lanterns.splice(i,1);
    }
  });

  requestAnimationFrame(draw);
}

setInterval(createLantern,1200);
draw();

/* éŸ³æ¨‚æ§åˆ¶ */
musicBtn.onclick=()=>{
  if(bgm.paused){
    bgm.play();
    musicBtn.textContent="ğŸ”Š éŸ³æ¨‚";
  }else{
    bgm.pause();
    musicBtn.textContent="ğŸ”‡ éœéŸ³";
  }
};

/* åå­—åŠŸèƒ½ */
function setName(name){
  text.textContent = `${name} å…ƒå®µå¿«æ¨‚`;
  nameBox.style.display="none";
  editBtn.style.display="block";
}

document.getElementById("nameBtn").onclick = () => {
  const name = nameInput.value.trim();
  if(!name) return;
  const newUrl = location.pathname + "?name=" + encodeURIComponent(name);
  history.replaceState(null,"",newUrl);
  setName(name);
};

editBtn.onclick=()=>{
  nameBox.style.display="block";
  editBtn.style.display="none";
};

const params = new URLSearchParams(location.search);
const urlName = params.get("name");
if(urlName){
  nameInput.value = urlName;
  setName(urlName);
}

/* LINE åˆ†äº« */
lineShareBtn.onclick=()=>{
    navigator.share({title:"å…ƒå®µç¥ç¦",url:url});
  const url = location.href;
  if(navigator.share){
  }else{
    window.open("https://social-plugins.line.me/lineit/share?url="+encodeURIComponent(url));
  }
};

/* é›¢é–‹åœæ­¢éŸ³æ¨‚ */
document.addEventListener("visibilitychange",()=>{if(document.hidden) bgm.pause();});
window.addEventListener("pagehide",()=>bgm.pause());
window.addEventListener("beforeunload",()=>bgm.pause());
</script>

</body>
</html>