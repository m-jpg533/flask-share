<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>DJ Radar Night Demo</title>

<style>
html,body{
  margin:0;
  padding:0;
  width:100%;
  height:100%;
  background:black;
  overflow:hidden;
  touch-action:none;
  font-family:Arial,Helvetica,sans-serif;
}

/* ====== 主舞台 ====== */
#stage{
  position:relative;
  width:100vw;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}

/* ====== YouTube ====== */
#player{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  pointer-events:auto;
}

/* ====== Click Layer（解鎖聲音）====== */
#clickLayer{
  position:absolute;
  inset:0;
  z-index:99;
  display:flex;
  justify-content:center;
  align-items:center;
  background:rgba(0,0,0,.85);
  color:#0ff;
  font-size:22px;
  letter-spacing:4px;
  cursor:pointer;
}

/* ====== 雷達 ====== */
#radar{
  position:absolute;
  width:280px;
  height:280px;
  border-radius:50%;
  border:2px solid rgba(0,255,255,.5);
  box-shadow:0 0 30px cyan;
  animation:spin 6s linear infinite;
}

@keyframes spin{
  from{transform:rotate(0deg)}
  to{transform:rotate(360deg)}
}

/* ====== Scratch 唱片 ====== */
#disc{
  position:absolute;
  width:200px;
  height:200px;
  border-radius:50%;
  background:radial-gradient(circle,#333 30%,#000 70%);
  box-shadow:0 0 40px #0ff;
  cursor:grab;
}

/* ====== HUD ====== */
#hud{
  position:absolute;
  top:15px;
  right:20px;
  color:#0ff;
  text-align:right;
}

#logo{
  font-size:20px;
  font-weight:bold;
  letter-spacing:4px;
}

#time{
  margin-top:8px;
  font-size:14px;
}

/* ====== 名曲牆 ====== */
#tracks{
  position:absolute;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  gap:12px;
}

.track{
  padding:8px 14px;
  border:1px solid cyan;
  color:cyan;
  cursor:pointer;
  background:black;
}
.track:hover{
  background:cyan;
  color:black;
}

/* ====== 倒數條 ====== */
#progress{
  position:absolute;
  bottom:0;
  left:0;
  height:4px;
  background:cyan;
  width:0%;
}

/* ====== Beat 閃 ====== */
.beat{
  box-shadow:inset 0 0 120px rgba(0,255,255,.35);
}
</style>
</head>

<body>

<div id="stage">

  <div id="clicklayer">

  <div id="player"></div>
  </div>
  <div id="radar"></div>
  <div id="disc"></div>

  <div id="hud">
    <div id="logo">DJ RADAR</div>
    <div id="time">00:00</div>
  </div>

  <div id="tracks">
    <div class="track" data-id="Uud4IHZ2B_g" data-drop="60">TRACK A</div>
    <div class="track" data-id="4F9r3G_2Qb0" data-drop="48">TRACK B</div>
    <div class="track" data-id="ui3IcnvbHFA" data-drop="72">TRACK C</div>
  </div>

  <div id="progress"></div>
</div>

<!-- ====== YouTube API ====== -->
<script src="https://www.youtube.com/iframe_api"></script>

<script>
let player;
let started=false;
let bpm=128;
let beatTimer;
let disc=document.getElementById("disc");
let isDrag=false,startX,rot=0;

function onYouTubeIframeAPIReady(){
  player=new YT.Player('player',{
    videoId:'IOcLRLu6HC0',
    playerVars:{
      controls:0,
      modestbranding:1,
      rel:0,
      playsinline:1
    },
    events:{
      onReady:()=>{},
    }
  });
}

/* ====== 點擊解鎖聲音 ====== */
clickLayer.onclick = () => {
  player.mute();
  player.playVideo();

  setTimeout(()=>{
    player.unMute();
  },300);

  clickLayer.style.display="none";
  started = true;
};


/* ====== 名曲牆切歌（不跳回第一支）====== */
document.querySelectorAll(".track").forEach(t=>{
  t.onclick=()=>{
    player.loadVideoById({
      videoId:t.dataset.id,
      startSeconds:parseInt(t.dataset.drop)
    });
  };
});

/* ====== Beat ====== */
function startBeat(){
  beatTimer=setInterval(()=>{
    document.body.classList.add("beat");
    setTimeout(()=>document.body.classList.remove("beat"),80);
  },60000/bpm);
}

/* ====== Scratch ====== */
disc.onpointerdown=e=>{
  isDrag=true;
  startX=e.clientX;
  disc.setPointerCapture(e.pointerId);
};

window.onpointermove=e=>{
  if(!isDrag||!started)return;
  let dx=e.clientX-startX;
  rot+=dx*0.5;
  disc.style.transform=`rotate(${rot}deg)`;
  let t=player.getCurrentTime()+dx*0.01;
  player.seekTo(Math.max(0,t),true);
  startX=e.clientX;
};

window.onpointerup=()=>isDrag=false;

/* ====== 時間 & 進度 ====== */
setInterval(()=>{
  if(player&&player.getDuration){
    let cur=player.getCurrentTime();
    let dur=player.getDuration();
    if(dur){
      time.innerText=
        Math.floor(cur/60).toString().padStart(2,"0")+":"+
        Math.floor(cur%60).toString().padStart(2,"0");
      progress.style.width=(cur/dur*100)+"%";
    }
  }
},300);
</script>

</body>
</html>

