<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å…ƒå®µç…™ç«ç¥ç¦</title>

<!-- LINE åˆ†äº«å°é¢ -->
<meta property="og:title" content="å…ƒå®µç…™ç«ç¥ç¦">
<meta property="og:description" content="é»é–‹çœ‹å°ˆå±¬ç…™ç«ç¥ç¦">
<meta property="og:image" content="https://m-jpg533.github.io/flask-media-share/fireworks-cover.jpg">
<meta property="og:type" content="website">

<style>
body{
  margin:0;
  background:black;
  overflow:hidden;
  touch-action:none;
}

canvas{
  position:absolute;
  z-index:1;
}

#text{
  position:fixed;
  width:100%;
  top:35%;
  text-align:center;
  font-size:48px;
  color:gold;
  font-weight:bold;
  z-index:10;
  animation: glow 1s infinite alternate;
}

@keyframes glow{
  from{ text-shadow:0 0 10px gold; }
  to{ text-shadow:0 0 30px yellow; }
}

#nameBox{
  position:fixed;
  top:50%;
  width:100%;
  text-align:center;
  z-index:15;
}

#nameBox input{
  font-size:20px;
  padding:8px;
  border-radius:6px;
  border:none;
}

#nameBox button{
  font-size:18px;
  padding:8px 12px;
  margin-left:6px;
  border:none;
  border-radius:6px;
}

#musicBtn{
  position:fixed;
  bottom:20px;
  right:20px;
  z-index:20;
  padding:10px 15px;
  font-size:16px;
  border:none;
  border-radius:8px;
}

#editBtn{
  position:fixed;
  top:20px;
  right:20px;
  z-index:20;
  padding:8px 12px;
  border:none;
  border-radius:6px;
}
</style>
</head>

<body>

<div id="text">ğŸ† å…ƒå®µå¿«æ¨‚ ğŸ†</div>

<div id="nameBox">
  <input id="nameInput" placeholder="è¼¸å…¥åå­—">
  <button id="nameBtn">ç¢ºèª</button>
</div>

<button id="editBtn" style="display:none;">é‡æ–°è¼¸å…¥åå­—</button>
<button id="musicBtn">ğŸ”Š éŸ³æ¨‚</button>

<canvas id="fire"></canvas>

<audio id="bgm">
  <source src="https://m-jpg533.github.io/flask-media-share/82.mp3" type="audio/mpeg">
</audio>

<script>
const canvas = document.getElementById("fire");
const ctx = canvas.getContext("2d");
const bgm = document.getElementById("bgm");
const text = document.getElementById("text");
const nameBox = document.getElementById("nameBox");
const nameInput = document.getElementById("nameInput");
const editBtn = document.getElementById("editBtn");
const musicBtn = document.getElementById("musicBtn");

function resize(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

let particles = [];
let fireColor = "hsl(45,100%,50%)";

/* æ ¹æ“šåå­—ç”¢ç”Ÿå›ºå®šé¡è‰² */
function getColorFromName(name){
  let hash = 0;
  for(let i=0;i<name.length;i++){
    hash = name.charCodeAt(i) + ((hash<<5)-hash);
  }
  let hue = Math.abs(hash)%360;
  return `hsl(${hue},100%,50%)`;
}

/* å½©è‰²ç…™ç« */
function createFirework(){
  let x = Math.random()*canvas.width;
  let y = Math.random()*canvas.height/2;

  for(let i=0;i<70;i++){
    particles.push({
      x,y,
      vx:(Math.random()-0.5)*6,
      vy:(Math.random()-0.5)*6,
      life:100,
      color:fireColor
    });
  }
}

function draw(){
  ctx.fillStyle="rgba(0,0,0,0.2)";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  particles.forEach((p,i)=>{
    ctx.beginPath();
    ctx.arc(p.x,p.y,2,0,Math.PI*2);
    ctx.fillStyle=p.color;
    ctx.fill();
    p.x+=p.vx;
    p.y+=p.vy;
    p.life--;
    if(p.life<=0) particles.splice(i,1);
  });

  requestAnimationFrame(draw);
}

setInterval(createFirework,800);
draw();

/* æ’­éŸ³æ¨‚ */
function userFire(){
  createFirework();
  bgm.play().catch(()=>{});
}
canvas.addEventListener("click", userFire);
canvas.addEventListener("touchstart", userFire);

/* éŸ³æ¨‚æ§åˆ¶ */
musicBtn.onclick=()=>{
  if(bgm.paused){
    bgm.play();
    musicBtn.textContent="ğŸ”Š éŸ³æ¨‚";
  }else{
    bgm.pause();
    musicBtn.textContent="ğŸ”‡ éœéŸ³";
  }
};

/* è§£æç¶²å€åå­— */
const params=new URLSearchParams(location.search);
const urlName=params.get("name");

if(urlName){
  setName(urlName);
}

/* è¨­å®šåå­— */
function setName(name){
  text.textContent=`ğŸ† ${name} å…ƒå®µå¿«æ¨‚ ğŸ†`;
  fireColor=getColorFromName(name);
  nameBox.style.display="none";
  editBtn.style.display="block";
}

/* æ‰‹å‹•è¼¸å…¥ */
document.getElementById("nameBtn").onclick=()=>{
  const name=nameInput.value.trim();
  if(name) setName(name);
};

/* é‡æ–°è¼¸å…¥ */
editBtn.onclick=()=>{
  nameBox.style.display="block";
  editBtn.style.display="none";
};

/* è‡ªå‹•åœéŸ³æ¨‚ */
bgm.addEventListener("ended",()=> musicBtn.textContent="ğŸ”‡ éœéŸ³");
document.addEventListener("visibilitychange",()=>{
  if(document.hidden) bgm.pause();
});
window.addEventListener("pagehide",()=>bgm.pause());
window.addEventListener("beforeunload",()=>bgm.pause());
</script>

</body>

</html>
