<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LINE 貼圖產生器</title>

<style>
body{
  margin:0;
  background:#111;
  color:white;
  text-align:center;
  font-family:Arial, sans-serif;
}

h2{
  color:gold;
}

canvas{
  width:260px;
  height:260px;
  margin-top:10px;
  background:transparent;
}

input{
  font-size:16px;
  padding:8px;
  border-radius:6px;
  border:none;
}

button{
  font-size:15px;
  padding:8px 12px;
  margin:6px;
  border:none;
  border-radius:8px;
}

#lineBtn{ background:#06C755; color:white; }
#downloadBtn{ background:orange; color:white; }
</style>
</head>

<body>

<h2>專屬新年 LINE 貼圖</h2>

<input id="nameInput" placeholder="輸入名字">
<button onclick="makeSticker()">產生貼圖</button>

<br>
<canvas id="card" width="512" height="512"></canvas>

<br>
<button id="lineBtn">LINE 分享</button>
<button id="downloadBtn">下載貼圖</button>

<script>
const canvas = document.getElementById("card");
const ctx = canvas.getContext("2d");
const nameInput = document.getElementById("nameInput");

let currentName = "";

/* ⭐ 產生貼圖 */
function makeSticker(){

  const name = nameInput.value.trim();
  if(!name) return;

  currentName = name;
  updateURL(name);

  ctx.clearRect(0,0,512,512);

  const img = new Image();
  img.crossOrigin = "anonymous";

  // ⭐ 改成你的圖片
  img.src = "https://m-jpg533.github.io/flask-share/67.jpg";

  img.onload = ()=>{

    /* ⭐ 畫底圖（置中裁切） */
    let scale = Math.max(512/img.width, 512/img.height);
    let w = img.width * scale;
    let h = img.height * scale;
    let x = (512 - w)/2;
    let y = (512 - h)/2;
    ctx.drawImage(img,x,y,w,h);

    /* ⭐ 遮原文字區域（可調整位置） */
    ctx.fillStyle = "rgba(0,0,0,0.45)";
    ctx.fillRect(0,120,240,260);

    /* ⭐ 金色祝福字 */
    ctx.fillStyle = "gold";
    ctx.font = "bold 42px Arial";
    ctx.textAlign = "center";

    ctx.shadowColor = "gold";
    ctx.shadowBlur = 20;

    ctx.fillText(name,256,420);
    ctx.fillText("新年快樂",256,470);

    ctx.shadowBlur = 0;
  };
}

/* ⭐ 下載 PNG */
document.getElementById("downloadBtn").onclick = ()=>{
  const link = document.createElement("a");
  link.download = "LINE貼圖.png";
  link.href = canvas.toDataURL("image/png");
  link.click();
};

/* ⭐ 分享（帶名字） */
document.getElementById("lineBtn").onclick = ()=>{
  const url = location.href;

  if(navigator.share){
    navigator.share({
      title:"新年貼圖",
      text:"送你專屬祝福",
      url:url
    });
  }else{
    window.open(
      "https://social-plugins.line.me/lineit/share?url=" +
      encodeURIComponent(url)
    );
  }
};

/* ⭐ 寫入網址 */
function updateURL(name){
  const newUrl = location.pathname + "?name=" + encodeURIComponent(name);
  history.replaceState(null,"",newUrl);
}

/* ⭐ 自動帶名字 */
const params = new URLSearchParams(location.search);
const urlName = params.get("name");
if(urlName){
  nameInput.value = urlName;
  makeSticker();
}
</script>

</body>
</html>